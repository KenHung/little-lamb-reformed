<script src="https://unpkg.com/vue@3"></script>
<script>
  var PixnetComments = {
    data() {
      return {
        articleId: '{{ page.id }}'.split('/').pop(),
        currentPage: 1,
        totalPages: [],
        comments: []
      }
    },
    methods: {
      getComments(page) {
        this.currentPage = page;

        var vm = this;
        var xhr = new XMLHttpRequest();
        var url = 'https://emma.pixnet.cc/blog/articles/' + this.articleId + '/comments'
          + '?user=mickey1124&page=' + this.currentPage + '&per_page=2';
        xhr.open('GET', url);
        xhr.onload = function () {
          if (xhr.status === 200) {
            var resp = JSON.parse(xhr.responseText);
            console.log(resp.message);
            vm.totalPages = [];
            for (var i = 1; i <= resp.total; i++) {
              vm.totalPages.push(i);
            }
            vm.comments = resp.comments;
          }
        }
        // TODO: add error handling
        xhr.send();
      },
      prevComments() { getComments(this.currentPage - 1); },
      nextComments() { getComments(this.currentPage + 1); }
    }
  };
  var vm = Vue.createApp(PixnetComments).mount('#pixnet-comments');
  vm.getComments(1);
</script>